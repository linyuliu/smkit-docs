---
title: SM4 åˆ†ç»„å¯†ç ç®—æ³•
icon: lock
---

# SM4 åˆ†ç»„å¯†ç ç®—æ³•

SM4 æ˜¯ä¸­å›½çš„åˆ†ç»„å¯†ç æ ‡å‡†ï¼Œç”¨äºå¯¹ç§°åŠ å¯†ï¼Œå¯†é’¥é•¿åº¦ 128 ä½ã€‚

## ç®—æ³•æ¦‚è¿°

::: info SM4 æ ‡å‡†
SM4 æ˜¯ä¸€ç§åˆ†ç»„å¯†ç ç®—æ³•ï¼Œåˆ†ç»„é•¿åº¦å’Œå¯†é’¥é•¿åº¦å‡ä¸º 128 ä½ã€‚

**æ ‡å‡†æ–‡æ¡£**ï¼š
- GM/T 0002-2012ï¼šSM4 åˆ†ç»„å¯†ç ç®—æ³•
:::

## ä¸»è¦ç‰¹æ€§

### ç®—æ³•å‚æ•°

| å‚æ•° | å€¼ |
| --- | --- |
| åˆ†ç»„é•¿åº¦ | 128 bits (16 bytes) |
| å¯†é’¥é•¿åº¦ | 128 bits (16 bytes) |
| è½®æ•° | 32 |
| ç»“æ„ | Feistel ç½‘ç»œ |

### å·¥ä½œæ¨¡å¼

SM4 æ”¯æŒå¤šç§å·¥ä½œæ¨¡å¼ï¼š

::: tabs

@tab ECB
**ç”µå­å¯†ç æœ¬æ¨¡å¼ (ECB)**
- æœ€ç®€å•çš„æ¨¡å¼
- ä¸æ¨èç”¨äºå¤§é‡æ•°æ®
- ç›¸åŒæ˜æ–‡å—äº§ç”Ÿç›¸åŒå¯†æ–‡å—

@tab CBC
**å¯†ç åˆ†ç»„é“¾æ¥æ¨¡å¼ (CBC)**
- æ¨èçš„æ¨¡å¼
- ä½¿ç”¨åˆå§‹å‘é‡ (IV)
- æ¯ä¸ªå¯†æ–‡å—ä¾èµ–å‰ä¸€ä¸ª

@tab CTR
**è®¡æ•°å™¨æ¨¡å¼ (CTR)**
- å°†åˆ†ç»„å¯†ç è½¬ä¸ºæµå¯†ç 
- æ”¯æŒå¹¶è¡ŒåŠ å¯†
- éœ€è¦éšæœºæ•°æˆ–è®¡æ•°å™¨

@tab GCM
**ä¼½ç½—ç“¦è®¡æ•°å™¨æ¨¡å¼ (GCM)**
- è®¤è¯åŠ å¯†æ¨¡å¼
- åŒæ—¶æä¾›åŠ å¯†å’Œè®¤è¯
- æœ€å®‰å…¨çš„æ¨¡å¼

:::

## å¿«é€Ÿå¼€å§‹

::: code-tabs#lang

@tab:active TypeScript

```typescript
import { SM4, Mode } from '@smkit/core';

// åˆ›å»º SM4 å®ä¾‹
const sm4 = new SM4();

// å¯†é’¥ (16 å­—èŠ‚)
const key = '0123456789abcdeffedcba9876543210';

// åŠ å¯†
const plaintext = 'è¿™æ˜¯éœ€è¦åŠ å¯†çš„æ•°æ®';
const ciphertext = sm4.encrypt(plaintext, key);
console.log('å¯†æ–‡:', ciphertext);

// è§£å¯†
const decrypted = sm4.decrypt(ciphertext, key);
console.log('æ˜æ–‡:', decrypted);

// ä½¿ç”¨ GCM æ¨¡å¼ï¼ˆæ›´å®‰å…¨ï¼‰
const sm4gcm = new SM4({ mode: Mode.GCM });
const encrypted = sm4gcm.encrypt(plaintext, key);
```

@tab Java

```java
import cn.smkit.SM4;
import cn.smkit.Mode;

SM4 sm4 = new SM4();

// å¯†é’¥ (16 å­—èŠ‚)
String key = "0123456789abcdeffedcba9876543210";

// åŠ å¯†
String plaintext = "è¿™æ˜¯éœ€è¦åŠ å¯†çš„æ•°æ®";
String ciphertext = sm4.encrypt(plaintext, key);
System.out.println("å¯†æ–‡: " + ciphertext);

// è§£å¯†
String decrypted = sm4.decrypt(ciphertext, key);
System.out.println("æ˜æ–‡: " + decrypted);

// ä½¿ç”¨ GCM æ¨¡å¼
SM4 sm4gcm = new SM4(Mode.GCM);
String encrypted = sm4gcm.encrypt(plaintext, key);
```

:::

## åŠ å¯†è½®å‡½æ•°

SM4 çš„åŠ å¯†å˜æ¢ç”± 32 è½®è¿­ä»£è¿ç®—ç»„æˆï¼š

$$
X_{i+4} = F(X_i, X_{i+1}, X_{i+2}, X_{i+3}, rk_i), \quad i = 0, 1, \ldots, 31
$$

å…¶ä¸­è½®å‡½æ•° $F$ å®šä¹‰ä¸ºï¼š

$$
F(X_0, X_1, X_2, X_3, rk) = X_0 \oplus T(X_1 \oplus X_2 \oplus X_3 \oplus rk)
$$

::: details åˆæˆç½®æ¢ T
$T$ å˜æ¢ç”±éçº¿æ€§å˜æ¢ $\tau$ å’Œçº¿æ€§å˜æ¢ $L$ å¤åˆè€Œæˆï¼š

$$
T(\cdot) = L(\tau(\cdot))
$$

**éçº¿æ€§å˜æ¢** $\tau$ ç”± 4 ä¸ª S ç›’å¹¶è¡Œæ„æˆï¼š

$$
\tau(A) = (S_{box}(a_0), S_{box}(a_1), S_{box}(a_2), S_{box}(a_3))
$$

**çº¿æ€§å˜æ¢** $L$ï¼š

$$
L(B) = B \oplus (B \lll 2) \oplus (B \lll 10) \oplus (B \lll 18) \oplus (B \lll 24)
$$

å…¶ä¸­ $\lll$ è¡¨ç¤ºå¾ªç¯å·¦ç§»ã€‚
:::

## åº”ç”¨åœºæ™¯

::: tip é€‚ç”¨åœºæ™¯
- âœ… **æ•°æ®åŠ å¯†**ï¼šæ–‡ä»¶ã€æ•°æ®åº“å­—æ®µåŠ å¯†
- âœ… **é€šä¿¡åŠ å¯†**ï¼šVPNã€SSL/TLS é€šä¿¡
- âœ… **å­˜å‚¨åŠ å¯†**ï¼šç£ç›˜åŠ å¯†ã€äº‘å­˜å‚¨åŠ å¯†
- âœ… **èº«ä»½è®¤è¯**ï¼šæŒ‘æˆ˜-åº”ç­”è®¤è¯
:::

## æ€§èƒ½å¯¹æ¯”

| å¹³å° | SM4 (MB/s) | AES (MB/s) |
| --- | --- | --- |
| Intel i7-12700K | 285 | 320 |
| Apple M1 | 240 | 280 |
| ARM Cortex-A72 | 150 | 180 |

::: note æ€§èƒ½è¯´æ˜
SM4 æ€§èƒ½ç•¥ä½äº AESï¼Œä½†ä»èƒ½æ»¡è¶³å¤§å¤šæ•°åº”ç”¨éœ€æ±‚ã€‚
:::

## å®‰å…¨å»ºè®®

::: danger é‡è¦æç¤º
1. **ä¸è¦ä½¿ç”¨ ECB æ¨¡å¼**ï¼šé™¤éåŠ å¯†å•ä¸ªåˆ†ç»„
2. **ä½¿ç”¨éšæœº IV**ï¼šCBC/CTR æ¨¡å¼éœ€è¦éšæœºåˆå§‹å‘é‡
3. **å¯†é’¥ç®¡ç†**ï¼šå®šæœŸè½®æ¢å¯†é’¥ï¼Œå®‰å…¨å­˜å‚¨å¯†é’¥
4. **ä½¿ç”¨ GCM æ¨¡å¼**ï¼šéœ€è¦è®¤è¯åŠ å¯†æ—¶ä¼˜å…ˆé€‰æ‹© GCM
:::

## æ·±å…¥å­¦ä¹ 

::: tip ç»§ç»­äº†è§£
- ğŸ“– [ç®—æ³•åŸç†](./algorithm.md) - SM4 ç®—æ³•è¯¦ç»†åŸç†
- ğŸ”§ [å·¥ä½œæ¨¡å¼](./modes.md) - å„ç§å·¥ä½œæ¨¡å¼è¯¦è§£
- ğŸ”’ [åŠ å¯†è¿‡ç¨‹](./encrypt.md) - åŠ å¯†å®ç°ç»†èŠ‚
- ğŸ”“ [è§£å¯†è¿‡ç¨‹](./decrypt.md) - è§£å¯†å®ç°ç»†èŠ‚
- ğŸ’¡ [ç¤ºä¾‹ä»£ç ](./examples.md) - å®ç”¨ç¤ºä¾‹
:::
